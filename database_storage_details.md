# How Data Was Stored in OpenMemory Database

## Overview

This document shows exactly how the conversation data for `conv_7401k9nt84z5enn8q0b6xs9jvzs0` was stored in the OpenMemory database.

## API Request to OpenMemory

### Endpoint
```
POST /memory/add
```

### Request Payload
```json
{
  "content": "[Full webhook payload as JSON string - 12,227 characters]",
  "user_id": "+16129782029",
  "filters": {
    "conversation_id": "conv_7401k9nt84z5enn8q0b6xs9jvzs0",
    "agent_id": "agent_5001k9myfdmae9ntkrhxfr5b4tqy",
    "event_type": "post_call_transcription",
    "event_timestamp": 1762742520
  }
}
```

## Database Storage Structure

### Memory Record Retrieved from Database

**Endpoint**: `GET /users/+16129782029/memories`

**Response Structure**:
```json
{
  "user_id": "+16129782029",
  "items": [
    {
      "id": "6a2a5728-570c-4407-9dc0-9d2d56824775",
      "content": "[Extracted/processed content]",
      "tags": [],
      "metadata": {},
      "created_at": 1762742521007,
      "updated_at": 1762742521007,
      "last_seen_at": 1762744363183,
      "salience": 1,
      "decay_lambda": 0.008,
      "primary_sector": "procedural",
      "version": 1
    }
  ]
}
```

## Database Fields Explained

### 1. **id** (Memory ID)
- **Value**: `6a2a5728-570c-4407-9dc0-9d2d56824775`
- **Type**: UUID (auto-generated by OpenMemory)
- **Purpose**: Unique identifier for the memory record

### 2. **user_id**
- **Value**: `+16129782029`
- **Type**: String
- **Purpose**: Memory isolation - all memories for this user are stored with this user_id
- **Source**: Extracted from `system__caller_id` in the webhook payload

### 3. **content**
- **Value**: Processed/extracted text from the JSON payload
- **Type**: String
- **Length**: Varies (OpenMemory extracts text from JSON)
- **Purpose**: The actual memory content that OpenMemory processes
- **Note**: OpenMemory automatically extracts text from the JSON payload and stores it in a processed format

### 4. **metadata**
- **Value**: `{}` (empty in retrieved record)
- **Type**: Object
- **Purpose**: Additional metadata filters
- **Note**: The `filters` sent in the request may be stored separately or used for indexing

### 5. **tags**
- **Value**: `[]` (empty array)
- **Type**: Array
- **Purpose**: Tags for categorizing memories

### 6. **created_at**
- **Value**: `1762742521007`
- **Type**: Unix timestamp (milliseconds)
- **Purpose**: When the memory was created
- **Converted**: 2025-11-10 02:42:01.007 UTC

### 7. **updated_at**
- **Value**: `1762742521007`
- **Type**: Unix timestamp (milliseconds)
- **Purpose**: When the memory was last updated

### 8. **last_seen_at**
- **Value**: `1762744363183`
- **Type**: Unix timestamp (milliseconds)
- **Purpose**: When the memory was last accessed/queried
- **Converted**: 2025-11-10 03:06:03.183 UTC

### 9. **salience**
- **Value**: `1`
- **Type**: Number
- **Purpose**: Importance/relevance score of the memory

### 10. **decay_lambda**
- **Value**: `0.008`
- **Type**: Number
- **Purpose**: Decay rate for memory retention

### 11. **primary_sector**
- **Value**: `"procedural"`
- **Type**: String
- **Purpose**: Memory categorization (episodic, semantic, procedural, emotional, reflective)
- **Note**: OpenMemory automatically categorizes memories

### 12. **version**
- **Value**: `1`
- **Type**: Number
- **Purpose**: Version of the memory record

## What Was Actually Stored

### Original Content Sent
The complete webhook payload (12,227 characters) was sent to OpenMemory:
- Full JSON structure with all fields
- Complete transcript with all conversation turns
- Analysis results
- Metadata
- Dynamic variables

### How OpenMemory Processes It
1. **Text Extraction**: OpenMemory extracts text from the JSON payload
2. **Categorization**: Automatically categorizes as "procedural" memory
3. **Indexing**: Indexes the content for semantic search
4. **Storage**: Stores the processed content in the database

### Metadata Filters
The following filters were sent with the request:
- `conversation_id`: `conv_7401k9nt84z5enn8q0b6xs9jvzs0`
- `agent_id`: `agent_5001k9myfdmae9ntkrhxfr5b4tqy`
- `event_type`: `post_call_transcription`
- `event_timestamp`: `1762742520`

**Note**: These filters may be used for querying but may not appear in the `metadata` field of the retrieved record.

## Database Query Methods

### 1. Direct Memory Retrieval
```bash
GET /users/{user_id}/memories
```
Returns all memories for a user.

### 2. Semantic Query
```bash
POST /memory/query
{
  "query": "conversation",
  "user_id": "+16129782029",
  "limit": 10,
  "filters": {
    "conversation_id": "conv_7401k9nt84z5enn8q0b6xs9jvzs0"
  }
}
```
**Note**: The query API may not return results even though data is stored (known limitation).

### 3. User Summary
```bash
GET /users/{user_id}/summary
```
Returns a summary of all memories for the user.

## Storage Confirmation

✅ **Data is stored**: User summary shows "1 memories, 1 patterns"
✅ **Memory ID**: `6a2a5728-570c-4407-9dc0-9d2d56824775`
✅ **Created**: 2025-11-10 02:42:01.007 UTC
✅ **Category**: Procedural memory
✅ **Salience**: 1

## Key Observations

1. **Content Processing**: OpenMemory extracts and processes text from JSON, storing it in a processed format
2. **Automatic Categorization**: Memories are automatically categorized (in this case, "procedural")
3. **Metadata Filters**: Filters sent during storage may not appear in retrieved metadata
4. **Query Limitations**: The semantic query API may not return results even though data is stored
5. **Direct Access**: The `/users/{user_id}/memories` endpoint provides direct access to stored memories

## Complete Storage Flow

1. **Webhook Received**: Post-call transcription webhook received
2. **User ID Extraction**: `system__caller_id` extracted as user_id (`+16129782029`)
3. **Payload Preparation**: Full webhook payload converted to JSON string
4. **Metadata Extraction**: Filters extracted (conversation_id, agent_id, event_type, event_timestamp)
5. **API Call**: POST to `/memory/add` with content, user_id, and filters
6. **OpenMemory Processing**:
   - Text extraction from JSON
   - Automatic categorization
   - Indexing for semantic search
   - Storage in database
7. **Response**: Memory ID returned (`6a2a5728-570c-4407-9dc0-9d2d56824775`)
8. **Verification**: User summary confirms storage

